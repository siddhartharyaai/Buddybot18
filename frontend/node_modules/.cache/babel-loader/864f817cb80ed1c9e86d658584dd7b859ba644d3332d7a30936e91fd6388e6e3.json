{"ast":null,"code":"import React,{useState,useRef,useEffect,useCallback}from'react';import{motion,AnimatePresence}from'framer-motion';import{MicrophoneIcon,StopIcon,PaperAirplaneIcon,SpeakerWaveIcon,SpeakerXMarkIcon,SparklesIcon,ChatBubbleLeftEllipsisIcon,EyeIcon,EyeSlashIcon,SunIcon,MoonIcon,Cog6ToothIcon}from'@heroicons/react/24/outline';import toast from'react-hot-toast';import TextInput from'./TextInput';import VoiceControl from'./VoiceControl';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const ChatInterface=_ref=>{let{user,darkMode,setDarkMode,sessionId,onSendMessage}=_ref;const[isAmbientListening,setIsAmbientListening]=useState(false);const[isConversationActive,setIsConversationActive]=useState(false);const[isRecording,setIsRecording]=useState(false);const[isPlaying,setIsPlaying]=useState(false);const[messages,setMessages]=useState([]);const[isLoading,setIsLoading]=useState(false);const[listeningState,setListeningState]=useState('inactive');// inactive, ambient, active\nconst[wakeWordDetected,setWakeWordDetected]=useState(false);const[isBotSpeaking,setIsBotSpeaking]=useState(false);const[currentTranscript,setCurrentTranscript]=useState('');const[botMood,setBotMood]=useState('friendly');// friendly, excited, calm, thinking\nconst mediaRecorderRef=useRef(null);const audioChunksRef=useRef([]);const messagesEndRef=useRef(null);const audioRef=useRef(null);const ambientRecorderRef=useRef(null);const ambientIntervalRef=useRef(null);const suggestions=[\"Tell me a story\",\"Sing a song\",\"What's a fun fact?\",\"Let's play a game\",\"Help me learn something\"];useEffect(()=>{scrollToBottom();},[messages]);useEffect(()=>{console.log('🎯 ChatInterface component mounted - NOT auto-starting ambient listening');// Don't auto-start ambient listening - wait for user gesture\nsetListeningState('inactive');// Cleanup on unmount\nreturn()=>{stopAmbientListening();if(ambientIntervalRef.current){clearInterval(ambientIntervalRef.current);}};},[]);const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});};const startAmbientListening=async stream=>{try{console.log('🎤 Starting ambient listening with provided stream...');console.log('User ID:',user===null||user===void 0?void 0:user.id);console.log('Session ID:',sessionId);// Start ambient listening on server\nconst response=await fetch(\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/api/ambient/start\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({session_id:sessionId,user_id:(user===null||user===void 0?void 0:user.id)||(user===null||user===void 0?void 0:user.user_id)||'test_user'})});if(response.ok){setIsAmbientListening(true);setListeningState('ambient');// Start continuous audio processing with the provided stream\nstartContinuousAudioProcessing(stream);toast.success('🎤 Voice activated! Say \"Hey Buddy\" to start chatting.');console.log('✅ Ambient listening started successfully');return true;// Return success\n}else{const errorData=await response.json();console.error('❌ Server error starting ambient listening:',errorData);throw new Error(\"Failed to start ambient listening: \".concat(errorData.detail||'Unknown error'));}}catch(error){console.error('❌ Error starting ambient listening:',error);setListeningState('inactive');toast.error('Failed to start voice features. Please try again.');return false;// Return failure\n}};const stopAmbientListening=async()=>{try{await fetch(\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/api/ambient/stop\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({session_id:sessionId})});setIsAmbientListening(false);setIsConversationActive(false);setListeningState('inactive');// Stop audio processing\nif(ambientRecorderRef.current){ambientRecorderRef.current.stop();}if(ambientIntervalRef.current){clearInterval(ambientIntervalRef.current);}}catch(error){console.error('Error stopping ambient listening:',error);}};// Stop continuous audio processing to prevent re-renders\nconst startContinuousAudioProcessing=stream=>{console.log('🎤 Starting continuous audio processing...');ambientRecorderRef.current=new MediaRecorder(stream,{mimeType:'audio/webm;codecs=opus'});ambientRecorderRef.current.ondataavailable=event=>{if(event.data.size>0){// Only process audio if we're still in ambient listening mode\nif(isAmbientListening&&listeningState==='ambient'){processAmbientAudio(event.data);}}};ambientRecorderRef.current.start(2000);// 2-second chunks\n// Set up interval to restart recording (prevent memory issues)\nambientIntervalRef.current=setInterval(()=>{if(ambientRecorderRef.current&&isAmbientListening){try{ambientRecorderRef.current.stop();setTimeout(()=>{if(ambientRecorderRef.current&&isAmbientListening){ambientRecorderRef.current.start(2000);}},100);}catch(error){console.error('Error restarting recorder:',error);}}},10000);// Restart every 10 seconds instead of processing continuously\n};const processAmbientAudio=async audioData=>{try{let base64Audio;// Handle different audio data types\nif(typeof audioData==='string'){base64Audio=audioData;}else{// Convert Blob to base64\nconst reader=new FileReader();return new Promise(resolve=>{reader.onloadend=async()=>{base64Audio=reader.result.split(',')[1];await sendAudioToBackend(base64Audio);resolve();};reader.readAsDataURL(audioData);});}await sendAudioToBackend(base64Audio);}catch(error){console.error('Error processing ambient audio:',error);}};const sendAudioToBackend=async base64Audio=>{try{const response=await fetch(\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/api/ambient/process\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({session_id:sessionId,audio_base64:base64Audio})});if(response.ok){const data=await response.json();handleAmbientResponse(data);}else{console.warn('Ambient processing request failed:',response.status);}}catch(error){console.error('Error sending audio to backend:',error);}};const handleAmbientResponse=data=>{const{status,transcript,listening_state,conversation_response,has_response}=data;// Only update listening state if it has changed\nsetListeningState(prevState=>{if(prevState!==listening_state){return listening_state;}return prevState;});if(status==='wake_word_detected'){setWakeWordDetected(true);setIsConversationActive(true);// Add wake word message\nconst wakeWordMessage={id:Date.now(),type:'system',content:\"Wake word detected: \\\"\".concat(transcript,\"\\\"\"),timestamp:new Date()};setMessages(prev=>[...prev,wakeWordMessage]);// Add AI response if available\nif(has_response&&conversation_response){const aiMessage={id:Date.now()+1,type:'ai',content:conversation_response.response_text,audioData:conversation_response.response_audio,timestamp:new Date()};setMessages(prev=>[...prev,aiMessage]);// Play audio response\nif(conversation_response.response_audio){playAudio(conversation_response.response_audio);}}// Clear wake word detection after 3 seconds\nsetTimeout(()=>setWakeWordDetected(false),3000);}else if(status==='conversation_active'&&has_response){// Add user message\nconst userMessage={id:Date.now(),type:'user',content:transcript,timestamp:new Date()};setMessages(prev=>[...prev,userMessage]);// Add AI response\nconst aiMessage={id:Date.now()+1,type:'ai',content:conversation_response.response_text,audioData:conversation_response.response_audio,timestamp:new Date()};setMessages(prev=>[...prev,aiMessage]);// Play audio response\nif(conversation_response.response_audio){playAudio(conversation_response.response_audio);}}else if(status==='conversation_ended'||status==='conversation_timeout'){setIsConversationActive(false);const endMessage={id:Date.now(),type:'system',content:status==='conversation_timeout'?'Conversation timed out. Say \"Hey Buddy\" to start again.':'Conversation ended. Say \"Hey Buddy\" to start again.',timestamp:new Date()};setMessages(prev=>[...prev,endMessage]);}};const startRecording=async()=>{try{const stream=await navigator.mediaDevices.getUserMedia({audio:true});mediaRecorderRef.current=new MediaRecorder(stream);audioChunksRef.current=[];mediaRecorderRef.current.ondataavailable=event=>{audioChunksRef.current.push(event.data);};mediaRecorderRef.current.onstop=()=>{const audioBlob=new Blob(audioChunksRef.current,{type:'audio/wav'});sendVoiceMessage(audioBlob);stream.getTracks().forEach(track=>track.stop());};mediaRecorderRef.current.start();setIsRecording(true);}catch(error){toast.error('Microphone access denied');}};const stopRecording=()=>{if(mediaRecorderRef.current&&isRecording){mediaRecorderRef.current.stop();setIsRecording(false);}};const sendVoiceMessage=async audioBlob=>{const reader=new FileReader();reader.onloadend=async()=>{const base64Audio=reader.result.split(',')[1];const userMessage={id:Date.now(),type:'user',content:'Voice message',isVoice:true,timestamp:new Date()};setMessages(prev=>[...prev,userMessage]);setIsLoading(true);try{const response=await fetch(\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/api/conversations/voice\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({session_id:sessionId,user_id:user.id,audio_base64:base64Audio})});const data=await response.json();if(response.ok){const aiMessage={id:Date.now()+1,type:'ai',content:data.response_text,audioData:data.response_audio,contentType:data.content_type,metadata:data.metadata,timestamp:new Date()};setMessages(prev=>[...prev,aiMessage]);// Auto-play AI response\nif(data.response_audio){playAudio(data.response_audio);}}else{throw new Error(data.detail||'Failed to send voice message');}}catch(error){toast.error('Failed to send voice message');console.error('Voice message error:',error);}finally{setIsLoading(false);}};reader.readAsDataURL(audioBlob);};const sendTextMessage=async messageText=>{if(!messageText||!messageText.trim()||isLoading)return;// Store the message content\nconst messageContent=messageText.trim();const userMessage={id:Date.now(),type:'user',content:messageContent,isVoice:false,timestamp:new Date()};setMessages(prev=>[...prev,userMessage]);setIsLoading(true);try{const response=await fetch(\"\".concat(process.env.REACT_APP_BACKEND_URL,\"/api/conversations/text\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({session_id:sessionId,user_id:user.id,message:messageContent// Use stored message content\n})});const data=await response.json();if(response.ok){const aiMessage={id:Date.now()+1,type:'ai',content:data.response_text,audioData:data.response_audio,contentType:data.content_type,metadata:data.metadata,timestamp:new Date()};setMessages(prev=>[...prev,aiMessage]);// Auto-play AI response\nif(data.response_audio){playAudio(data.response_audio);}}else{throw new Error(data.detail||'Failed to send message');}}catch(error){toast.error('Failed to send message');console.error('Text message error:',error);}finally{setIsLoading(false);}};const playAudio=base64Audio=>{if(audioRef.current){audioRef.current.pause();}const audioBlob=new Blob([Uint8Array.from(atob(base64Audio),c=>c.charCodeAt(0))],{type:'audio/wav'});const audioUrl=URL.createObjectURL(audioBlob);audioRef.current=new Audio(audioUrl);audioRef.current.play();setIsPlaying(true);setIsBotSpeaking(true);audioRef.current.onended=()=>{setIsPlaying(false);setIsBotSpeaking(false);URL.revokeObjectURL(audioUrl);};};const stopAudio=()=>{if(audioRef.current){audioRef.current.pause();audioRef.current.currentTime=0;setIsPlaying(false);setIsBotSpeaking(false);}};const formatTime=date=>{return date.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});};const getListeningStateDisplay=()=>{switch(listeningState){case'ambient':return{text:'Always Listening',color:'text-blue-600',bgColor:'bg-blue-50',icon:EyeIcon};case'active':return{text:'Conversation Active',color:'text-green-600',bgColor:'bg-green-50',icon:MicrophoneIcon};default:return{text:'Not Listening',color:'text-gray-600',bgColor:'bg-gray-50',icon:EyeSlashIcon};}};// Dynamic background based on mood/energy\nconst getBackgroundClass=()=>{const base=darkMode?'bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900':'bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50';switch(botMood){case'excited':return darkMode?'bg-gradient-to-br from-purple-900 via-pink-900 to-orange-900':'bg-gradient-to-br from-yellow-100 via-orange-100 to-pink-100';case'calm':return darkMode?'bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900':'bg-gradient-to-br from-blue-100 via-indigo-100 to-purple-100';case'thinking':return darkMode?'bg-gradient-to-br from-gray-800 via-slate-800 to-gray-900':'bg-gradient-to-br from-gray-100 via-slate-100 to-gray-200';default:return base;}};// Animated Bot Avatar Component\nconst BotAvatar=()=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center h-full p-8\",children:[/*#__PURE__*/_jsxs(motion.div,{className:\"relative w-48 h-48 rounded-full flex items-center justify-center mb-6 \".concat(darkMode?'bg-gradient-to-br from-blue-600 to-purple-700':'bg-gradient-to-br from-blue-500 to-purple-600'),animate:{scale:isBotSpeaking?[1,1.05,1]:[1,1.02,1],rotate:listeningState==='active'?[0,2,-2,0]:0},transition:{scale:{duration:2,repeat:Infinity,ease:\"easeInOut\"},rotate:{duration:3,repeat:Infinity,ease:\"easeInOut\"}},children:[/*#__PURE__*/_jsx(motion.div,{className:\"absolute inset-4 rounded-full bg-white/20 backdrop-blur-sm\",animate:{opacity:isBotSpeaking?[0.3,0.7,0.3]:[0.2,0.4,0.2]},transition:{duration:1.5,repeat:Infinity,ease:\"easeInOut\"}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-6\",children:[/*#__PURE__*/_jsx(motion.div,{className:\"w-6 h-12 bg-white rounded-full\",animate:{scaleY:isBotSpeaking?[1,0.3,1]:[1,0.8,1]},transition:{duration:2,repeat:Infinity,ease:\"easeInOut\"}}),/*#__PURE__*/_jsx(motion.div,{className:\"w-6 h-12 bg-white rounded-full\",animate:{scaleY:isBotSpeaking?[1,0.3,1]:[1,0.8,1]},transition:{duration:2,repeat:Infinity,ease:\"easeInOut\",delay:0.1}})]}),/*#__PURE__*/_jsx(AnimatePresence,{children:(isBotSpeaking||listeningState==='active')&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(motion.div,{className:\"absolute inset-0 rounded-full border-2 border-white/30\",initial:{scale:1,opacity:0.6},animate:{scale:1.5,opacity:0},exit:{opacity:0},transition:{duration:1.5,repeat:Infinity,ease:\"easeOut\"}}),/*#__PURE__*/_jsx(motion.div,{className:\"absolute inset-0 rounded-full border-2 border-white/20\",initial:{scale:1,opacity:0.4},animate:{scale:2,opacity:0},exit:{opacity:0},transition:{duration:2,repeat:Infinity,ease:\"easeOut\",delay:0.3}})]})})]}),/*#__PURE__*/_jsxs(motion.div,{className:\"text-center \".concat(darkMode?'text-white':'text-gray-800'),animate:{opacity:[0.7,1,0.7]},transition:{duration:2,repeat:Infinity,ease:\"easeInOut\"},children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-2xl font-bold mb-2\",children:[\"Hi \",(user===null||user===void 0?void 0:user.name)||'there',\"! \\uD83D\\uDC4B\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-lg opacity-80\",children:listeningState==='active'?'I\\'m listening...':isBotSpeaking?'Speaking...':isAmbientListening?'Say \"Hey Buddy\" to chat!':'Ready to chat!'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 text-4xl\",children:[botMood==='excited'&&'🤗',botMood==='calm'&&'😌',botMood==='thinking'&&'🤔',botMood==='friendly'&&'😊']})]});// Live Transcript Component\nconst LiveTranscript=()=>/*#__PURE__*/_jsxs(\"div\",{className:\"h-full flex flex-col \".concat(darkMode?'bg-gray-800 text-white':'bg-white text-gray-900',\" border-l \").concat(darkMode?'border-gray-700':'border-gray-200'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 p-4 border-b \".concat(darkMode?'border-gray-700 bg-gray-900':'border-gray-200 bg-gray-50'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(ChatBubbleLeftEllipsisIcon,{className:\"w-6 h-6 \".concat(darkMode?'text-blue-400':'text-blue-600')}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:\"Live Chat\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setDarkMode(!darkMode),className:\"p-2 rounded-full transition-colors \".concat(darkMode?'bg-gray-700 text-yellow-400 hover:bg-gray-600':'bg-gray-100 text-gray-600 hover:bg-gray-200'),children:darkMode?/*#__PURE__*/_jsx(SunIcon,{className:\"w-5 h-5\"}):/*#__PURE__*/_jsx(MoonIcon,{className:\"w-5 h-5\"})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto p-4 space-y-4\",children:[messages.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-6xl mb-4\",children:\"\\uD83C\\uDF99\\uFE0F\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"text-lg font-semibold mb-2 \".concat(darkMode?'text-gray-200':'text-gray-800'),children:\"Start Talking!\"}),/*#__PURE__*/_jsx(\"p\",{className:\"\".concat(darkMode?'text-gray-400':'text-gray-600',\" mb-6\"),children:\"Your conversation will appear here in real-time\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col space-y-2\",children:suggestions.map((suggestion,index)=>/*#__PURE__*/_jsx(motion.button,{onClick:()=>sendTextMessage(suggestion),className:\"px-4 py-2 rounded-full text-sm transition-colors \".concat(darkMode?'bg-blue-900 text-blue-200 hover:bg-blue-800':'bg-blue-50 text-blue-600 hover:bg-blue-100'),whileHover:{scale:1.02},whileTap:{scale:0.98},children:suggestion},index))})]}):/*#__PURE__*/_jsx(AnimatePresence,{children:messages.map(message=>/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:\"flex \".concat(message.type==='user'?'justify-end':'justify-start'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-sm\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-3 rounded-2xl \".concat(message.type==='user'?darkMode?'bg-gradient-to-r from-blue-600 to-purple-700 text-white':'bg-gradient-to-r from-blue-500 to-purple-600 text-white':darkMode?'bg-gray-700 text-gray-100':'bg-gray-100 text-gray-900'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[message.type==='ai'&&/*#__PURE__*/_jsx(\"span\",{className:\"text-xl\",children:\"\\uD83E\\uDD16\"}),message.type==='user'&&/*#__PURE__*/_jsx(\"span\",{className:\"text-xl\",children:\"\\uD83D\\uDC76\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm leading-relaxed\",children:message.content})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mt-1 px-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-xs \".concat(darkMode?'text-gray-400':'text-gray-500'),children:formatTime(message.timestamp)}),message.audioData&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>playAudio(message.audioData),className:\"p-1 rounded transition-colors \".concat(darkMode?'text-blue-400 hover:text-blue-300 hover:bg-gray-700':'text-blue-500 hover:text-blue-600 hover:bg-blue-50'),children:/*#__PURE__*/_jsx(SpeakerWaveIcon,{className:\"w-4 h-4\"})})]})]})},message.id))}),currentTranscript&&/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:\"flex justify-end\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-sm px-4 py-2 rounded-2xl border-2 border-dashed \".concat(darkMode?'border-blue-500 bg-blue-900/20 text-blue-200':'border-blue-300 bg-blue-50 text-blue-800'),children:/*#__PURE__*/_jsx(\"p\",{className:\"text-sm italic\",children:currentTranscript})})}),isLoading&&/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},className:\"flex justify-start\",children:/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-3 rounded-2xl \".concat(darkMode?'bg-gray-700':'bg-gray-100'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-xl\",children:\"\\uD83E\\uDD16\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full animate-bounce \".concat(darkMode?'bg-blue-400':'bg-blue-500')}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full animate-bounce \".concat(darkMode?'bg-blue-400':'bg-blue-500'),style:{animationDelay:'0.1s'}}),/*#__PURE__*/_jsx(\"div\",{className:\"w-2 h-2 rounded-full animate-bounce \".concat(darkMode?'bg-blue-400':'bg-blue-500'),style:{animationDelay:'0.2s'}})]}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm \".concat(darkMode?'text-gray-300':'text-gray-600'),children:\"Thinking...\"})]})})}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 p-4 border-t \".concat(darkMode?'border-gray-700 bg-gray-900':'border-gray-200 bg-gray-50'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1\",children:/*#__PURE__*/_jsx(TextInput,{onSendMessage:sendTextMessage,isLoading:isLoading,darkMode:darkMode})}),/*#__PURE__*/_jsx(VoiceControl,{onStartAmbientListening:startAmbientListening,onStopAmbientListening:stopAmbientListening,darkMode:darkMode})]})})]});return/*#__PURE__*/_jsx(\"div\",{className:\"h-full \".concat(getBackgroundClass(),\" transition-all duration-1000\"),children:/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 h-full\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-96 lg:min-h-full\",children:/*#__PURE__*/_jsx(BotAvatar,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"h-full min-h-96 lg:min-h-full\",children:/*#__PURE__*/_jsx(LiveTranscript,{})})]})});};export default ChatInterface;","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","motion","AnimatePresence","MicrophoneIcon","StopIcon","PaperAirplaneIcon","SpeakerWaveIcon","SpeakerXMarkIcon","SparklesIcon","ChatBubbleLeftEllipsisIcon","EyeIcon","EyeSlashIcon","SunIcon","MoonIcon","Cog6ToothIcon","toast","TextInput","VoiceControl","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ChatInterface","_ref","user","darkMode","setDarkMode","sessionId","onSendMessage","isAmbientListening","setIsAmbientListening","isConversationActive","setIsConversationActive","isRecording","setIsRecording","isPlaying","setIsPlaying","messages","setMessages","isLoading","setIsLoading","listeningState","setListeningState","wakeWordDetected","setWakeWordDetected","isBotSpeaking","setIsBotSpeaking","currentTranscript","setCurrentTranscript","botMood","setBotMood","mediaRecorderRef","audioChunksRef","messagesEndRef","audioRef","ambientRecorderRef","ambientIntervalRef","suggestions","scrollToBottom","console","log","stopAmbientListening","current","clearInterval","_messagesEndRef$curre","scrollIntoView","behavior","startAmbientListening","stream","id","response","fetch","concat","process","env","REACT_APP_BACKEND_URL","method","headers","body","JSON","stringify","session_id","user_id","ok","startContinuousAudioProcessing","success","errorData","json","error","Error","detail","stop","MediaRecorder","mimeType","ondataavailable","event","data","size","processAmbientAudio","start","setInterval","setTimeout","audioData","base64Audio","reader","FileReader","Promise","resolve","onloadend","result","split","sendAudioToBackend","readAsDataURL","audio_base64","handleAmbientResponse","warn","status","transcript","listening_state","conversation_response","has_response","prevState","wakeWordMessage","Date","now","type","content","timestamp","prev","aiMessage","response_text","response_audio","playAudio","userMessage","endMessage","startRecording","navigator","mediaDevices","getUserMedia","audio","push","onstop","audioBlob","Blob","sendVoiceMessage","getTracks","forEach","track","stopRecording","isVoice","contentType","content_type","metadata","sendTextMessage","messageText","trim","messageContent","message","pause","Uint8Array","from","atob","c","charCodeAt","audioUrl","URL","createObjectURL","Audio","play","onended","revokeObjectURL","stopAudio","currentTime","formatTime","date","toLocaleTimeString","hour","minute","getListeningStateDisplay","text","color","bgColor","icon","getBackgroundClass","base","BotAvatar","className","children","div","animate","scale","rotate","transition","duration","repeat","Infinity","ease","opacity","scaleY","delay","initial","exit","name","LiveTranscript","onClick","length","map","suggestion","index","button","whileHover","whileTap","y","style","animationDelay","ref","onStartAmbientListening","onStopAmbientListening"],"sources":["/app/frontend/src/components/ChatInterface.js"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { \n  MicrophoneIcon, \n  StopIcon, \n  PaperAirplaneIcon,\n  SpeakerWaveIcon,\n  SpeakerXMarkIcon,\n  SparklesIcon,\n  ChatBubbleLeftEllipsisIcon,\n  EyeIcon,\n  EyeSlashIcon,\n  SunIcon,\n  MoonIcon,\n  Cog6ToothIcon\n} from '@heroicons/react/24/outline';\nimport toast from 'react-hot-toast';\nimport TextInput from './TextInput';\nimport VoiceControl from './VoiceControl';\n\nconst ChatInterface = ({ user, darkMode, setDarkMode, sessionId, onSendMessage }) => {\n  const [isAmbientListening, setIsAmbientListening] = useState(false);\n  const [isConversationActive, setIsConversationActive] = useState(false);\n  const [isRecording, setIsRecording] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [listeningState, setListeningState] = useState('inactive'); // inactive, ambient, active\n  const [wakeWordDetected, setWakeWordDetected] = useState(false);\n  const [isBotSpeaking, setIsBotSpeaking] = useState(false);\n  const [currentTranscript, setCurrentTranscript] = useState('');\n  const [botMood, setBotMood] = useState('friendly'); // friendly, excited, calm, thinking\n  \n  const mediaRecorderRef = useRef(null);\n  const audioChunksRef = useRef([]);\n  const messagesEndRef = useRef(null);\n  const audioRef = useRef(null);\n  const ambientRecorderRef = useRef(null);\n  const ambientIntervalRef = useRef(null);\n\n  const suggestions = [\n    \"Tell me a story\",\n    \"Sing a song\", \n    \"What's a fun fact?\",\n    \"Let's play a game\",\n    \"Help me learn something\"\n  ];\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  useEffect(() => {\n    console.log('🎯 ChatInterface component mounted - NOT auto-starting ambient listening');\n    \n    // Don't auto-start ambient listening - wait for user gesture\n    setListeningState('inactive');\n    \n    // Cleanup on unmount\n    return () => {\n      stopAmbientListening();\n      if (ambientIntervalRef.current) {\n        clearInterval(ambientIntervalRef.current);\n      }\n    };\n  }, []);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const startAmbientListening = async (stream) => {\n    try {\n      console.log('🎤 Starting ambient listening with provided stream...');\n      console.log('User ID:', user?.id);\n      console.log('Session ID:', sessionId);\n      \n      // Start ambient listening on server\n      const response = await fetch(`${process.env.REACT_APP_BACKEND_URL}/api/ambient/start`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          session_id: sessionId,\n          user_id: user?.id || user?.user_id || 'test_user'\n        })\n      });\n\n      if (response.ok) {\n        setIsAmbientListening(true);\n        setListeningState('ambient');\n        \n        // Start continuous audio processing with the provided stream\n        startContinuousAudioProcessing(stream);\n        \n        toast.success('🎤 Voice activated! Say \"Hey Buddy\" to start chatting.');\n        console.log('✅ Ambient listening started successfully');\n        return true; // Return success\n      } else {\n        const errorData = await response.json();\n        console.error('❌ Server error starting ambient listening:', errorData);\n        throw new Error(`Failed to start ambient listening: ${errorData.detail || 'Unknown error'}`);\n      }\n    } catch (error) {\n      console.error('❌ Error starting ambient listening:', error);\n      setListeningState('inactive');\n      toast.error('Failed to start voice features. Please try again.');\n      return false; // Return failure\n    }\n  };\n\n  const stopAmbientListening = async () => {\n    try {\n      await fetch(`${process.env.REACT_APP_BACKEND_URL}/api/ambient/stop`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          session_id: sessionId\n        })\n      });\n\n      setIsAmbientListening(false);\n      setIsConversationActive(false);\n      setListeningState('inactive');\n      \n      // Stop audio processing\n      if (ambientRecorderRef.current) {\n        ambientRecorderRef.current.stop();\n      }\n      \n      if (ambientIntervalRef.current) {\n        clearInterval(ambientIntervalRef.current);\n      }\n    } catch (error) {\n      console.error('Error stopping ambient listening:', error);\n    }\n  };\n\n  // Stop continuous audio processing to prevent re-renders\n  const startContinuousAudioProcessing = (stream) => {\n    console.log('🎤 Starting continuous audio processing...');\n    \n    ambientRecorderRef.current = new MediaRecorder(stream, {\n      mimeType: 'audio/webm;codecs=opus'\n    });\n\n    ambientRecorderRef.current.ondataavailable = (event) => {\n      if (event.data.size > 0) {\n        // Only process audio if we're still in ambient listening mode\n        if (isAmbientListening && listeningState === 'ambient') {\n          processAmbientAudio(event.data);\n        }\n      }\n    };\n\n    ambientRecorderRef.current.start(2000); // 2-second chunks\n    \n    // Set up interval to restart recording (prevent memory issues)\n    ambientIntervalRef.current = setInterval(() => {\n      if (ambientRecorderRef.current && isAmbientListening) {\n        try {\n          ambientRecorderRef.current.stop();\n          setTimeout(() => {\n            if (ambientRecorderRef.current && isAmbientListening) {\n              ambientRecorderRef.current.start(2000);\n            }\n          }, 100);\n        } catch (error) {\n          console.error('Error restarting recorder:', error);\n        }\n      }\n    }, 10000); // Restart every 10 seconds instead of processing continuously\n  };\n\n  const processAmbientAudio = async (audioData) => {\n    try {\n      let base64Audio;\n      \n      // Handle different audio data types\n      if (typeof audioData === 'string') {\n        base64Audio = audioData;\n      } else {\n        // Convert Blob to base64\n        const reader = new FileReader();\n        return new Promise((resolve) => {\n          reader.onloadend = async () => {\n            base64Audio = reader.result.split(',')[1];\n            await sendAudioToBackend(base64Audio);\n            resolve();\n          };\n          reader.readAsDataURL(audioData);\n        });\n      }\n      \n      await sendAudioToBackend(base64Audio);\n    } catch (error) {\n      console.error('Error processing ambient audio:', error);\n    }\n  };\n  \n  const sendAudioToBackend = async (base64Audio) => {\n    try {\n      const response = await fetch(`${process.env.REACT_APP_BACKEND_URL}/api/ambient/process`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          session_id: sessionId,\n          audio_base64: base64Audio\n        })\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        handleAmbientResponse(data);\n      } else {\n        console.warn('Ambient processing request failed:', response.status);\n      }\n    } catch (error) {\n      console.error('Error sending audio to backend:', error);\n    }\n  };\n\n  const handleAmbientResponse = (data) => {\n    const { status, transcript, listening_state, conversation_response, has_response } = data;\n    \n    // Only update listening state if it has changed\n    setListeningState(prevState => {\n      if (prevState !== listening_state) {\n        return listening_state;\n      }\n      return prevState;\n    });\n    \n    if (status === 'wake_word_detected') {\n      setWakeWordDetected(true);\n      setIsConversationActive(true);\n      \n      // Add wake word message\n      const wakeWordMessage = {\n        id: Date.now(),\n        type: 'system',\n        content: `Wake word detected: \"${transcript}\"`,\n        timestamp: new Date()\n      };\n      \n      setMessages(prev => [...prev, wakeWordMessage]);\n      \n      // Add AI response if available\n      if (has_response && conversation_response) {\n        const aiMessage = {\n          id: Date.now() + 1,\n          type: 'ai',\n          content: conversation_response.response_text,\n          audioData: conversation_response.response_audio,\n          timestamp: new Date()\n        };\n        \n        setMessages(prev => [...prev, aiMessage]);\n        \n        // Play audio response\n        if (conversation_response.response_audio) {\n          playAudio(conversation_response.response_audio);\n        }\n      }\n      \n      // Clear wake word detection after 3 seconds\n      setTimeout(() => setWakeWordDetected(false), 3000);\n      \n    } else if (status === 'conversation_active' && has_response) {\n      // Add user message\n      const userMessage = {\n        id: Date.now(),\n        type: 'user',\n        content: transcript,\n        timestamp: new Date()\n      };\n      \n      setMessages(prev => [...prev, userMessage]);\n      \n      // Add AI response\n      const aiMessage = {\n        id: Date.now() + 1,\n        type: 'ai',\n        content: conversation_response.response_text,\n        audioData: conversation_response.response_audio,\n        timestamp: new Date()\n      };\n      \n      setMessages(prev => [...prev, aiMessage]);\n      \n      // Play audio response\n      if (conversation_response.response_audio) {\n        playAudio(conversation_response.response_audio);\n      }\n      \n    } else if (status === 'conversation_ended' || status === 'conversation_timeout') {\n      setIsConversationActive(false);\n      \n      const endMessage = {\n        id: Date.now(),\n        type: 'system',\n        content: status === 'conversation_timeout' ? 'Conversation timed out. Say \"Hey Buddy\" to start again.' : 'Conversation ended. Say \"Hey Buddy\" to start again.',\n        timestamp: new Date()\n      };\n      \n      setMessages(prev => [...prev, endMessage]);\n    }\n  };\n\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      mediaRecorderRef.current = new MediaRecorder(stream);\n      audioChunksRef.current = [];\n\n      mediaRecorderRef.current.ondataavailable = (event) => {\n        audioChunksRef.current.push(event.data);\n      };\n\n      mediaRecorderRef.current.onstop = () => {\n        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/wav' });\n        sendVoiceMessage(audioBlob);\n        stream.getTracks().forEach(track => track.stop());\n      };\n\n      mediaRecorderRef.current.start();\n      setIsRecording(true);\n    } catch (error) {\n      toast.error('Microphone access denied');\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const sendVoiceMessage = async (audioBlob) => {\n    const reader = new FileReader();\n    reader.onloadend = async () => {\n      const base64Audio = reader.result.split(',')[1];\n      \n      const userMessage = {\n        id: Date.now(),\n        type: 'user',\n        content: 'Voice message',\n        isVoice: true,\n        timestamp: new Date()\n      };\n\n      setMessages(prev => [...prev, userMessage]);\n      setIsLoading(true);\n\n      try {\n        const response = await fetch(`${process.env.REACT_APP_BACKEND_URL}/api/conversations/voice`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            session_id: sessionId,\n            user_id: user.id,\n            audio_base64: base64Audio\n          })\n        });\n\n        const data = await response.json();\n        \n        if (response.ok) {\n          const aiMessage = {\n            id: Date.now() + 1,\n            type: 'ai',\n            content: data.response_text,\n            audioData: data.response_audio,\n            contentType: data.content_type,\n            metadata: data.metadata,\n            timestamp: new Date()\n          };\n\n          setMessages(prev => [...prev, aiMessage]);\n          \n          // Auto-play AI response\n          if (data.response_audio) {\n            playAudio(data.response_audio);\n          }\n        } else {\n          throw new Error(data.detail || 'Failed to send voice message');\n        }\n      } catch (error) {\n        toast.error('Failed to send voice message');\n        console.error('Voice message error:', error);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    \n    reader.readAsDataURL(audioBlob);\n  };\n\n  const sendTextMessage = async (messageText) => {\n    if (!messageText || !messageText.trim() || isLoading) return;\n\n    // Store the message content\n    const messageContent = messageText.trim();\n    \n    const userMessage = {\n      id: Date.now(),\n      type: 'user',\n      content: messageContent,\n      isVoice: false,\n      timestamp: new Date()\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    setIsLoading(true);\n\n    try {\n      const response = await fetch(`${process.env.REACT_APP_BACKEND_URL}/api/conversations/text`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          session_id: sessionId,\n          user_id: user.id,\n          message: messageContent // Use stored message content\n        })\n      });\n\n      const data = await response.json();\n      \n      if (response.ok) {\n        const aiMessage = {\n          id: Date.now() + 1,\n          type: 'ai',\n          content: data.response_text,\n          audioData: data.response_audio,\n          contentType: data.content_type,\n          metadata: data.metadata,\n          timestamp: new Date()\n        };\n\n        setMessages(prev => [...prev, aiMessage]);\n        \n        // Auto-play AI response\n        if (data.response_audio) {\n          playAudio(data.response_audio);\n        }\n      } else {\n        throw new Error(data.detail || 'Failed to send message');\n      }\n    } catch (error) {\n      toast.error('Failed to send message');\n      console.error('Text message error:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const playAudio = (base64Audio) => {\n    if (audioRef.current) {\n      audioRef.current.pause();\n    }\n    \n    const audioBlob = new Blob([Uint8Array.from(atob(base64Audio), c => c.charCodeAt(0))], { type: 'audio/wav' });\n    const audioUrl = URL.createObjectURL(audioBlob);\n    \n    audioRef.current = new Audio(audioUrl);\n    audioRef.current.play();\n    setIsPlaying(true);\n    setIsBotSpeaking(true);\n    \n    audioRef.current.onended = () => {\n      setIsPlaying(false);\n      setIsBotSpeaking(false);\n      URL.revokeObjectURL(audioUrl);\n    };\n  };\n\n  const stopAudio = () => {\n    if (audioRef.current) {\n      audioRef.current.pause();\n      audioRef.current.currentTime = 0;\n      setIsPlaying(false);\n      setIsBotSpeaking(false);\n    }\n  };\n\n  const formatTime = (date) => {\n    return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n  };\n\n  const getListeningStateDisplay = () => {\n    switch (listeningState) {\n      case 'ambient':\n        return {\n          text: 'Always Listening',\n          color: 'text-blue-600',\n          bgColor: 'bg-blue-50',\n          icon: EyeIcon\n        };\n      case 'active':\n        return {\n          text: 'Conversation Active',\n          color: 'text-green-600',\n          bgColor: 'bg-green-50',\n          icon: MicrophoneIcon\n        };\n      default:\n        return {\n          text: 'Not Listening',\n          color: 'text-gray-600',\n          bgColor: 'bg-gray-50',\n          icon: EyeSlashIcon\n        };\n    }\n  };\n\n  // Dynamic background based on mood/energy\n  const getBackgroundClass = () => {\n    const base = darkMode \n      ? 'bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900'\n      : 'bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50';\n    \n    switch(botMood) {\n      case 'excited':\n        return darkMode \n          ? 'bg-gradient-to-br from-purple-900 via-pink-900 to-orange-900'\n          : 'bg-gradient-to-br from-yellow-100 via-orange-100 to-pink-100';\n      case 'calm':\n        return darkMode \n          ? 'bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900'\n          : 'bg-gradient-to-br from-blue-100 via-indigo-100 to-purple-100';\n      case 'thinking':\n        return darkMode \n          ? 'bg-gradient-to-br from-gray-800 via-slate-800 to-gray-900'\n          : 'bg-gradient-to-br from-gray-100 via-slate-100 to-gray-200';\n      default:\n        return base;\n    }\n  };\n\n  // Animated Bot Avatar Component\n  const BotAvatar = () => (\n    <div className=\"flex flex-col items-center justify-center h-full p-8\">\n      {/* Main Avatar Circle */}\n      <motion.div\n        className={`relative w-48 h-48 rounded-full flex items-center justify-center mb-6 ${\n          darkMode ? 'bg-gradient-to-br from-blue-600 to-purple-700' : 'bg-gradient-to-br from-blue-500 to-purple-600'\n        }`}\n        animate={{\n          scale: isBotSpeaking ? [1, 1.05, 1] : [1, 1.02, 1],\n          rotate: listeningState === 'active' ? [0, 2, -2, 0] : 0,\n        }}\n        transition={{\n          scale: { duration: 2, repeat: Infinity, ease: \"easeInOut\" },\n          rotate: { duration: 3, repeat: Infinity, ease: \"easeInOut\" }\n        }}\n      >\n        {/* Inner Glow Effect */}\n        <motion.div \n          className=\"absolute inset-4 rounded-full bg-white/20 backdrop-blur-sm\"\n          animate={{\n            opacity: isBotSpeaking ? [0.3, 0.7, 0.3] : [0.2, 0.4, 0.2]\n          }}\n          transition={{ duration: 1.5, repeat: Infinity, ease: \"easeInOut\" }}\n        />\n        \n        {/* Eyes */}\n        <div className=\"flex space-x-6\">\n          <motion.div \n            className=\"w-6 h-12 bg-white rounded-full\"\n            animate={{\n              scaleY: isBotSpeaking ? [1, 0.3, 1] : [1, 0.8, 1]\n            }}\n            transition={{ duration: 2, repeat: Infinity, ease: \"easeInOut\" }}\n          />\n          <motion.div \n            className=\"w-6 h-12 bg-white rounded-full\"\n            animate={{\n              scaleY: isBotSpeaking ? [1, 0.3, 1] : [1, 0.8, 1]\n            }}\n            transition={{ duration: 2, repeat: Infinity, ease: \"easeInOut\", delay: 0.1 }}\n          />\n        </div>\n\n        {/* Voice Rings */}\n        <AnimatePresence>\n          {(isBotSpeaking || listeningState === 'active') && (\n            <>\n              <motion.div\n                className=\"absolute inset-0 rounded-full border-2 border-white/30\"\n                initial={{ scale: 1, opacity: 0.6 }}\n                animate={{ scale: 1.5, opacity: 0 }}\n                exit={{ opacity: 0 }}\n                transition={{ duration: 1.5, repeat: Infinity, ease: \"easeOut\" }}\n              />\n              <motion.div\n                className=\"absolute inset-0 rounded-full border-2 border-white/20\"\n                initial={{ scale: 1, opacity: 0.4 }}\n                animate={{ scale: 2, opacity: 0 }}\n                exit={{ opacity: 0 }}\n                transition={{ duration: 2, repeat: Infinity, ease: \"easeOut\", delay: 0.3 }}\n              />\n            </>\n          )}\n        </AnimatePresence>\n      </motion.div>\n\n      {/* Status Text */}\n      <motion.div\n        className={`text-center ${darkMode ? 'text-white' : 'text-gray-800'}`}\n        animate={{ opacity: [0.7, 1, 0.7] }}\n        transition={{ duration: 2, repeat: Infinity, ease: \"easeInOut\" }}\n      >\n        <h2 className=\"text-2xl font-bold mb-2\">Hi {user?.name || 'there'}! 👋</h2>\n        <p className=\"text-lg opacity-80\">\n          {listeningState === 'active' ? 'I\\'m listening...' : \n           isBotSpeaking ? 'Speaking...' :\n           isAmbientListening ? 'Say \"Hey Buddy\" to chat!' : \n           'Ready to chat!'}\n        </p>\n      </motion.div>\n\n      {/* Mood Emojis */}\n      <div className=\"mt-6 text-4xl\">\n        {botMood === 'excited' && '🤗'}\n        {botMood === 'calm' && '😌'}\n        {botMood === 'thinking' && '🤔'}\n        {botMood === 'friendly' && '😊'}\n      </div>\n    </div>\n  );\n\n  // Live Transcript Component\n  const LiveTranscript = () => (\n    <div className={`h-full flex flex-col ${darkMode ? 'bg-gray-800 text-white' : 'bg-white text-gray-900'} border-l ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>\n      {/* Transcript Header */}\n      <div className={`flex-shrink-0 p-4 border-b ${darkMode ? 'border-gray-700 bg-gray-900' : 'border-gray-200 bg-gray-50'}`}>\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <ChatBubbleLeftEllipsisIcon className={`w-6 h-6 ${darkMode ? 'text-blue-400' : 'text-blue-600'}`} />\n            <h3 className=\"text-lg font-semibold\">Live Chat</h3>\n          </div>\n          \n          {/* Theme Toggle */}\n          <button\n            onClick={() => setDarkMode(!darkMode)}\n            className={`p-2 rounded-full transition-colors ${\n              darkMode ? 'bg-gray-700 text-yellow-400 hover:bg-gray-600' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            {darkMode ? <SunIcon className=\"w-5 h-5\" /> : <MoonIcon className=\"w-5 h-5\" />}\n          </button>\n        </div>\n      </div>\n\n      {/* Messages Area */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n        {messages.length === 0 ? (\n          <div className=\"text-center py-8\">\n            <div className=\"text-6xl mb-4\">🎙️</div>\n            <h4 className={`text-lg font-semibold mb-2 ${darkMode ? 'text-gray-200' : 'text-gray-800'}`}>\n              Start Talking!\n            </h4>\n            <p className={`${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-6`}>\n              Your conversation will appear here in real-time\n            </p>\n            \n            {/* Quick Suggestions */}\n            <div className=\"flex flex-col space-y-2\">\n              {suggestions.map((suggestion, index) => (\n                <motion.button\n                  key={index}\n                  onClick={() => sendTextMessage(suggestion)}\n                  className={`px-4 py-2 rounded-full text-sm transition-colors ${\n                    darkMode \n                      ? 'bg-blue-900 text-blue-200 hover:bg-blue-800' \n                      : 'bg-blue-50 text-blue-600 hover:bg-blue-100'\n                  }`}\n                  whileHover={{ scale: 1.02 }}\n                  whileTap={{ scale: 0.98 }}\n                >\n                  {suggestion}\n                </motion.button>\n              ))}\n            </div>\n          </div>\n        ) : (\n          <AnimatePresence>\n            {messages.map((message) => (\n              <motion.div\n                key={message.id}\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: -20 }}\n                className={`flex ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}\n              >\n                <div className=\"max-w-sm\">\n                  {/* Message Bubble */}\n                  <div\n                    className={`px-4 py-3 rounded-2xl ${\n                      message.type === 'user'\n                        ? darkMode \n                          ? 'bg-gradient-to-r from-blue-600 to-purple-700 text-white'\n                          : 'bg-gradient-to-r from-blue-500 to-purple-600 text-white'\n                        : darkMode\n                        ? 'bg-gray-700 text-gray-100'\n                        : 'bg-gray-100 text-gray-900'\n                    }`}\n                  >\n                    <div className=\"flex items-start space-x-2\">\n                      {message.type === 'ai' && (\n                        <span className=\"text-xl\">🤖</span>\n                      )}\n                      {message.type === 'user' && (\n                        <span className=\"text-xl\">👶</span>\n                      )}\n                      <p className=\"text-sm leading-relaxed\">{message.content}</p>\n                    </div>\n                  </div>\n                  \n                  {/* Message Actions */}\n                  <div className=\"flex items-center justify-between mt-1 px-2\">\n                    <span className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>\n                      {formatTime(message.timestamp)}\n                    </span>\n                    \n                    {message.audioData && (\n                      <button\n                        onClick={() => playAudio(message.audioData)}\n                        className={`p-1 rounded transition-colors ${\n                          darkMode \n                            ? 'text-blue-400 hover:text-blue-300 hover:bg-gray-700' \n                            : 'text-blue-500 hover:text-blue-600 hover:bg-blue-50'\n                        }`}\n                      >\n                        <SpeakerWaveIcon className=\"w-4 h-4\" />\n                      </button>\n                    )}\n                  </div>\n                </div>\n              </motion.div>\n            ))}\n          </AnimatePresence>\n        )}\n        \n        {/* Current Transcript Preview */}\n        {currentTranscript && (\n          <motion.div\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"flex justify-end\"\n          >\n            <div className={`max-w-sm px-4 py-2 rounded-2xl border-2 border-dashed ${\n              darkMode \n                ? 'border-blue-500 bg-blue-900/20 text-blue-200' \n                : 'border-blue-300 bg-blue-50 text-blue-800'\n            }`}>\n              <p className=\"text-sm italic\">{currentTranscript}</p>\n            </div>\n          </motion.div>\n        )}\n        \n        {/* Loading Animation */}\n        {isLoading && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            className=\"flex justify-start\"\n          >\n            <div className={`px-4 py-3 rounded-2xl ${\n              darkMode ? 'bg-gray-700' : 'bg-gray-100'\n            }`}>\n              <div className=\"flex items-center space-x-2\">\n                <span className=\"text-xl\">🤖</span>\n                <div className=\"flex space-x-1\">\n                  <div className={`w-2 h-2 rounded-full animate-bounce ${\n                    darkMode ? 'bg-blue-400' : 'bg-blue-500'\n                  }`}></div>\n                  <div className={`w-2 h-2 rounded-full animate-bounce ${\n                    darkMode ? 'bg-blue-400' : 'bg-blue-500'\n                  }`} style={{ animationDelay: '0.1s' }}></div>\n                  <div className={`w-2 h-2 rounded-full animate-bounce ${\n                    darkMode ? 'bg-blue-400' : 'bg-blue-500'\n                  }`} style={{ animationDelay: '0.2s' }}></div>\n                </div>\n                <span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-600'}`}>\n                  Thinking...\n                </span>\n              </div>\n            </div>\n          </motion.div>\n        )}\n        \n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Text Input Area */}\n      <div className={`flex-shrink-0 p-4 border-t ${darkMode ? 'border-gray-700 bg-gray-900' : 'border-gray-200 bg-gray-50'}`}>\n        <div className=\"flex items-center justify-between space-x-4\">\n          {/* Isolated Text Input Component */}\n          <div className=\"flex-1\">\n            <TextInput \n              onSendMessage={sendTextMessage} \n              isLoading={isLoading}\n              darkMode={darkMode}\n            />\n          </div>\n          \n          {/* Voice Control Component */}\n          <VoiceControl \n            onStartAmbientListening={startAmbientListening}\n            onStopAmbientListening={stopAmbientListening}\n            darkMode={darkMode}\n          />\n        </div>\n      </div>\n\n    </div>\n  );\n\n  return (\n    <div className={`h-full ${getBackgroundClass()} transition-all duration-1000`}>\n      {/* Modern 2-Panel Layout */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 h-full\">\n        {/* Left Panel - Animated Bot Avatar */}\n        <div className=\"flex items-center justify-center min-h-96 lg:min-h-full\">\n          <BotAvatar />\n        </div>\n\n        {/* Right Panel - Live Transcript */}\n        <div className=\"h-full min-h-96 lg:min-h-full\">\n          <LiveTranscript />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ChatInterface;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}